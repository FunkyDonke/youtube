<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Clone</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- FontAwesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- React & ReactDOM CDN -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  
  <!-- Babel for JSX compilation in browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- YouTube Iframe API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // YouTube API রেডি হলে React কে জানানোর জন্য
    window.ytApiLoaded = false;
    function onYouTubeIframeAPIReady() {
      window.ytApiLoaded = true;
      window.dispatchEvent(new Event('yt-api-ready'));
    }
  </script>
</head>
<body class="bg-[#0f0f0f] text-white font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const initialVideos = [
      {
        id: 'aqz-KE-bpKQ',
        title: 'Big Buck Bunny 60fps 4K - Official Blender Foundation Short Film',
        channel: 'Blender',
        views: '12M',
        timestamp: '10 years ago',
        thumbnail: 'https://img.youtube.com/vi/aqz-KE-bpKQ/maxresdefault.jpg',
        channelAvatar: 'https://ui-avatars.com/api/?name=Blender&background=random',
      },
      {
        id: 'LXb3EKWsInQ',
        title: 'COSTA RICA IN 4K 60fps HDR (ULTRA HD)',
        channel: 'Jacob + Katie Schwarz',
        views: '150M',
        timestamp: '5 years ago',
        thumbnail: 'https://img.youtube.com/vi/LXb3EKWsInQ/maxresdefault.jpg',
        channelAvatar: 'https://ui-avatars.com/api/?name=Jacob&background=random',
      },
      {
        id: 'w7ejDZ8SWv8',
        title: 'React JS Crash Course for Beginners',
        channel: 'Code Step By Step',
        views: '2.5M',
        timestamp: '1 year ago',
        thumbnail: 'https://img.youtube.com/vi/w7ejDZ8SWv8/maxresdefault.jpg',
        channelAvatar: 'https://ui-avatars.com/api/?name=Code&background=random',
      },
      {
        id: '094y1Z2wpJg',
        title: 'Beautiful Nature - Relaxing Music, Beautiful Landscapes',
        channel: 'Nature Relaxation',
        views: '8M',
        timestamp: '2 years ago',
        thumbnail: 'https://img.youtube.com/vi/094y1Z2wpJg/maxresdefault.jpg',
        channelAvatar: 'https://ui-avatars.com/api/?name=Nature&background=random',
      },
      {
        id: 'dGcsHMXbSOA',
        title: 'Bangla Natok | X-Boyfriend | এক্স বয়ফ্রেন্ড',
        channel: 'Bangla Entertainment',
        views: '15M',
        timestamp: '3 years ago',
        thumbnail: 'https://img.youtube.com/vi/dGcsHMXbSOA/maxresdefault.jpg',
        channelAvatar: 'https://ui-avatars.com/api/?name=Bangla&background=random',
      },
      {
        id: 'kJQP7kiw5Fk',
        title: 'Luis Fonsi - Despacito ft. Daddy Yankee',
        channel: 'Luis Fonsi',
        views: '8.3B',
        timestamp: '7 years ago',
        thumbnail: 'https://img.youtube.com/vi/kJQP7kiw5Fk/maxresdefault.jpg',
        channelAvatar: 'https://ui-avatars.com/api/?name=Luis&background=random',
      }
    ];

    function App() {
      const [videos] = useState(initialVideos);
      const [currentVideo, setCurrentVideo] = useState(null);
      const [searchQuery, setSearchQuery] = useState('');
      const [isSidebarOpen, setIsSidebarOpen] = useState(true);
      const [activeTab, setActiveTab] = useState('home');
      const [watchHistory, setWatchHistory] = useState([]);
      const [lastWatched, setLastWatched] = useState(null);

      // Miniplayer & Drag-and-Drop States
      const [isMiniplayer, setIsMiniplayer] = useState(false);
      const [position, setPosition] = useState({ x: 0, y: 0 });
      const [isDragging, setIsDragging] = useState(false);
      const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });

      // Resize States
      const [playerSize, setPlayerSize] = useState({ width: 384 }); // Default 384px width
      const [isResizing, setIsResizing] = useState(false);
      const [resizeOffset, setResizeOffset] = useState({ initialWidth: 0, initialX: 0 });

      // YouTube API States
      const [ytReady, setYtReady] = useState(window.ytApiLoaded);
      const playerRef = useRef(null);
      const timeIntervalRef = useRef(null);

      // Load History
      useEffect(() => {
        const savedHistory = localStorage.getItem('ytCloneHistory');
        const savedLastWatched = localStorage.getItem('ytCloneLastWatched');
        
        if (savedHistory) setWatchHistory(JSON.parse(savedHistory));
        if (savedLastWatched) setLastWatched(JSON.parse(savedLastWatched));

        const handleReady = () => setYtReady(true);
        window.addEventListener('yt-api-ready', handleReady);
        return () => window.removeEventListener('yt-api-ready', handleReady);
      }, []);

      // Initialize / Update YouTube Player
      useEffect(() => {
        if (!ytReady) return;
        
        if (!currentVideo) {
            // যদি ভিডিও ক্লোজ করা হয়, প্লেয়ার ডেস্ট্রয় করে দিন
            if (playerRef.current) {
                playerRef.current.destroy();
                playerRef.current = null;
            }
            return;
        }

        // লোকাল স্টোরেজ থেকে সেভ করা সময় (watch time) বের করা
        const currentTimes = JSON.parse(localStorage.getItem('ytCloneTimes') || '{}');
        const startSeconds = currentTimes[currentVideo.id] || 0;

        if (!playerRef.current) {
            // নতুন প্লেয়ার তৈরি করা
            playerRef.current = new window.YT.Player('yt-player-div', {
                videoId: currentVideo.id,
                playerVars: { 
                    autoplay: 1, 
                    start: startSeconds,
                    enablejsapi: 1,
                    playsinline: 1
                },
                events: {
                    onStateChange: (e) => {
                        // যখন ভিডিও চলছে, তখন প্রতি সেকেন্ডে সময় সেভ করা
                        if (e.data === window.YT.PlayerState.PLAYING) {
                            timeIntervalRef.current = setInterval(() => {
                                if (playerRef.current && playerRef.current.getCurrentTime) {
                                    const time = Math.floor(playerRef.current.getCurrentTime());
                                    const times = JSON.parse(localStorage.getItem('ytCloneTimes') || '{}');
                                    times[currentVideo.id] = time;
                                    localStorage.setItem('ytCloneTimes', JSON.stringify(times));
                                }
                            }, 1000);
                        } else {
                            clearInterval(timeIntervalRef.current);
                        }
                    }
                }
            });
        } else {
            // আগের প্লেয়ারেই নতুন ভিডিও লোড করা (রিলোড ছাড়াই)
            playerRef.current.loadVideoById({
                videoId: currentVideo.id,
                startSeconds: startSeconds
            });
        }

        return () => clearInterval(timeIntervalRef.current);
      }, [currentVideo, ytReady]);

      const playVideo = (video) => {
        setCurrentVideo(video);
        setLastWatched(video);
        setIsMiniplayer(false); 
        setPosition({x: 0, y: 0});
        
        const updatedHistory = [video, ...watchHistory.filter(v => v.id !== video.id)].slice(0, 20);
        setWatchHistory(updatedHistory);
        localStorage.setItem('ytCloneHistory', JSON.stringify(updatedHistory));
        localStorage.setItem('ytCloneLastWatched', JSON.stringify(video));
      };

      const filteredVideos = videos.filter(video => 
        video.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
        video.channel.toLowerCase().includes(searchQuery.toLowerCase())
      );

      // --- Drag and Drop Logic ---
      const handleDragStart = (e) => {
        if (e.target.closest('button')) return; // বাটনে ক্লিক করলে ড্র্যাগ বন্ধ
        setIsDragging(true);
        const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        const clientY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
        setDragOffset({ x: clientX - position.x, y: clientY - position.y });
      };

      // --- Resize Logic ---
      const handleResizeStart = (e) => {
        e.stopPropagation();
        e.preventDefault();
        setIsResizing(true);
        const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        setResizeOffset({ initialWidth: playerSize.width, initialX: clientX });
      };

      // Mouse Move & Up Listeners
      useEffect(() => {
        const handleMove = (e) => {
          const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
          const clientY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
          
          if (isDragging) {
            setPosition({ x: clientX - dragOffset.x, y: clientY - dragOffset.y });
          } else if (isResizing) {
            // বাঁদিকের কোণা ধরে টানলে width বাড়বে
            const dx = resizeOffset.initialX - clientX;
            let newWidth = resizeOffset.initialWidth + dx;
            if (newWidth < 280) newWidth = 280; // Minimum size
            if (newWidth > 800) newWidth = 800; // Maximum size
            setPlayerSize({ width: newWidth });
          }
        };

        const handleUp = () => {
          setIsDragging(false);
          setIsResizing(false);
        };

        if (isDragging || isResizing) {
          window.addEventListener('mousemove', handleMove);
          window.addEventListener('mouseup', handleUp);
          window.addEventListener('touchmove', handleMove, { passive: false });
          window.addEventListener('touchend', handleUp);
        }
        return () => {
          window.removeEventListener('mousemove', handleMove);
          window.removeEventListener('mouseup', handleUp);
          window.removeEventListener('touchmove', handleMove);
          window.removeEventListener('touchend', handleUp);
        };
      }, [isDragging, isResizing, dragOffset, resizeOffset]);

      return (
        <div className="min-h-screen flex flex-col relative overflow-hidden">
          {/* Navbar */}
          <header className="flex items-center justify-between px-4 py-2 sticky top-0 bg-[#0f0f0f] z-50 h-16 border-b border-white/10">
            <div className="flex items-center gap-4">
              <button 
                onClick={() => setIsSidebarOpen(!isSidebarOpen)}
                className="p-2 hover:bg-white/10 rounded-full transition-colors"
              >
                <i className="fas fa-bars text-xl"></i>
              </button>
              <div 
                className="flex items-center gap-2 cursor-pointer" 
                onClick={() => { 
                  if (currentVideo) setIsMiniplayer(true); // হোমপেজে গেলে সিমলেস মিনিপ্লেয়ার
                  setActiveTab('home'); 
                }}
              >
                <i className="fab fa-youtube text-red-600 text-3xl"></i>
                <span className="text-xl font-bold tracking-tighter hidden sm:block">YouTube</span>
              </div>
            </div>

            <div className="flex-1 max-w-2xl flex items-center ml-4 mr-4">
              <div className="flex w-full bg-[#121212] border border-white/20 rounded-full overflow-hidden focus-within:border-blue-500">
                <input 
                  type="text" 
                  placeholder="অনুসন্ধান করুন..." 
                  className="w-full bg-transparent px-4 py-2 outline-none text-white placeholder-gray-400"
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                />
                <button className="px-5 bg-white/10 hover:bg-white/20 transition-colors border-l border-white/20">
                  <i className="fas fa-search text-gray-300"></i>
                </button>
              </div>
            </div>

            <div className="flex items-center gap-3">
              <button className="p-2 hover:bg-white/10 rounded-full hidden sm:block">
                <i className="fas fa-bell text-xl"></i>
              </button>
              <button className="p-1.5 bg-blue-600 rounded-full w-8 h-8 flex items-center justify-center">
                <i className="fas fa-user"></i>
              </button>
            </div>
          </header>

          <div className="flex flex-1 overflow-hidden">
            {/* Sidebar */}
            <aside className={`${isSidebarOpen ? 'w-60' : 'w-20'} hidden md:flex flex-col bg-[#0f0f0f] transition-all duration-300 overflow-y-auto px-2 py-3 border-r border-white/10`}>
              <SidebarItem icon={<i className="fas fa-home text-xl"></i>} label="হোম" isOpen={isSidebarOpen} active={activeTab === 'home' && !currentVideo} onClick={() => { setActiveTab('home'); if(currentVideo) setIsMiniplayer(true); }} />
              <SidebarItem icon={<i className="fab fa-youtube text-xl"></i>} label="শর্টস" isOpen={isSidebarOpen} />
              
              {isSidebarOpen && <hr className="border-white/20 my-3" />}
              
              <SidebarItem icon={<i className="fas fa-history text-xl"></i>} label="ইতিহাস" isOpen={isSidebarOpen} active={activeTab === 'history'} onClick={() => { setActiveTab('history'); if(currentVideo) setIsMiniplayer(true); }} />
            </aside>

            <main className="flex-1 overflow-y-auto bg-[#0f0f0f] relative">
              
              {/* --- PERSISTENT VIDEO PLAYER VIEW --- 
                  This CSS trick prevents the video from ever unmounting! */}
              <div 
                className={`max-w-[1600px] mx-auto p-4 flex-col lg:flex-row gap-6 
                  ${(currentVideo && !isMiniplayer) ? 'flex' : 'absolute w-0 h-0 overflow-hidden invisible'}
                `}
              >
                <div className="flex-1 lg:w-2/3 flex flex-col">
                  
                  {/* The Video Container */}
                  {currentVideo && (
                    <div 
                      className={`transition-all duration-300
                        ${isMiniplayer 
                          ? 'fixed bg-[#212121] rounded-xl shadow-2xl z-[100] border border-gray-700 flex flex-col overflow-hidden visible' 
                          : 'w-full aspect-video bg-black rounded-xl overflow-hidden shadow-lg relative'
                        }
                      `}
                      style={isMiniplayer ? {
                        width: `${playerSize.width}px`,
                        transform: `translate(${position.x}px, ${position.y}px)`,
                        bottom: '24px', right: '24px',
                        transition: isDragging || isResizing ? 'none' : 'transform 0.1s ease-out'
                      } : {}}
                    >
                      {/* Miniplayer Drag Header */}
                      {isMiniplayer && (
                        <div className="flex justify-between items-center p-3 bg-[#181818] cursor-move select-none" onMouseDown={handleDragStart} onTouchStart={handleDragStart}>
                          <div className="flex flex-col truncate pr-2 w-[75%]">
                            <span className="text-sm font-bold truncate text-white">{currentVideo.title}</span>
                            <span className="text-xs text-gray-400 truncate">{currentVideo.channel}</span>
                          </div>
                          <div className="flex gap-4 text-gray-400 items-center">
                            <button onClick={() => setIsMiniplayer(false)} className="hover:text-white" title="Expand">
                              <i className="fas fa-expand-alt"></i>
                            </button>
                            <button onClick={() => { setCurrentVideo(null); setIsMiniplayer(false); }} className="hover:text-white" title="Close">
                              <i className="fas fa-times text-lg"></i>
                            </button>
                          </div>
                        </div>
                      )}

                      {/* The actual YouTube Player Area */}
                      <div className="w-full relative aspect-video bg-black pointer-events-auto">
                        {/* Invisible overlay during drag/resize to fix iframe block bugs */}
                        {(isDragging || isResizing) && <div className="absolute inset-0 z-10 bg-transparent"></div>}
                        <div id="yt-player-div" className="w-full h-full"></div>
                      </div>

                      {/* Miniplayer Resize Handle (Bottom-Left) */}
                      {isMiniplayer && (
                        <div 
                          className="absolute bottom-0 left-0 w-8 h-8 cursor-sw-resize z-20 flex items-end justify-start p-1.5 opacity-60 hover:opacity-100"
                          onMouseDown={handleResizeStart}
                          onTouchStart={handleResizeStart}
                          title="Resize"
                        >
                          <i className="fas fa-caret-down transform rotate-45 text-white text-sm"></i>
                        </div>
                      )}
                    </div>
                  )}

                  {/* Video Details (Hidden in Miniplayer mode) */}
                  <div className={`${isMiniplayer ? 'hidden' : 'block'}`}>
                    <h1 className="text-xl md:text-2xl font-bold mt-4 mb-2">{currentVideo?.title}</h1>
                    
                    <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                      <div className="flex items-center gap-3">
                        <img src={currentVideo?.channelAvatar} alt={currentVideo?.channel} className="w-10 h-10 rounded-full" />
                        <div>
                          <h3 className="font-bold text-sm">{currentVideo?.channel}</h3>
                          <p className="text-xs text-gray-400">১.২ মি. সাবস্ক্রাইবার</p>
                        </div>
                        <button className="bg-white text-black px-4 py-2 rounded-full font-bold ml-2 hover:bg-gray-200 transition">সাবস্ক্রাইব</button>
                      </div>
                      
                      <div className="flex items-center gap-2">
                        <button onClick={() => setIsMiniplayer(true)} className="flex items-center gap-2 px-4 py-2 bg-white/10 rounded-full hover:bg-white/20 transition font-bold" title="Miniplayer">
                          <i className="fas fa-compress-alt"></i> মিনিপ্লেয়ার
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Recommendations */}
                <div className={`lg:w-1/3 w-full flex flex-col gap-3 ${isMiniplayer ? 'hidden' : 'flex'}`}>
                  <h3 className="font-bold text-lg mb-2">আপনার জন্য প্রস্তাবিত</h3>
                  {videos.filter(v => v?.id !== currentVideo?.id).map(video => (
                    <div key={video.id} className="flex gap-2 cursor-pointer group" onClick={() => playVideo(video)}>
                      <div className="w-40 h-24 flex-shrink-0 relative rounded-lg overflow-hidden">
                        <img src={video.thumbnail} alt={video.title} className="w-full h-full object-cover group-hover:scale-105 transition duration-300" />
                      </div>
                      <div className="flex flex-col">
                        <h4 className="text-sm font-semibold line-clamp-2 group-hover:text-blue-400">{video.title}</h4>
                        <p className="text-xs text-gray-400 mt-1">{video.channel}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* --- HOME / GRID VIEW --- */}
              <div className={`p-4 sm:p-6 lg:p-8 max-w-[1800px] mx-auto ${(!currentVideo || isMiniplayer) ? 'block' : 'hidden'}`}>
                
                {/* Resume Banner */}
                {activeTab === 'home' && lastWatched && !searchQuery && (
                  <div className="mb-8 bg-gradient-to-r from-blue-900/40 to-purple-900/40 border border-white/10 rounded-2xl p-4 flex flex-col sm:flex-row items-center justify-between gap-4 shadow-xl">
                    <div className="flex items-center gap-4 w-full sm:w-auto">
                      <div className="w-32 aspect-video rounded-lg overflow-hidden flex-shrink-0 relative cursor-pointer" onClick={() => playVideo(lastWatched)}>
                        <img src={lastWatched.thumbnail} alt="Resume" className="w-full h-full object-cover" />
                        <div className="absolute inset-0 bg-black/40 flex items-center justify-center hover:bg-black/20">
                          <i className="fas fa-play-circle text-3xl text-white"></i>
                        </div>
                      </div>
                      <div>
                        <h3 className="text-sm text-blue-300 font-semibold mb-1 flex items-center gap-2">
                          <i className="fas fa-history"></i> রিজিউম (যেখান থেকে শেষ করেছিলেন)
                        </h3>
                        <h4 className="font-bold line-clamp-1">{lastWatched.title}</h4>
                      </div>
                    </div>
                    <button 
                      onClick={() => playVideo(lastWatched)}
                      className="bg-white text-black px-6 py-2 rounded-full font-bold hover:bg-gray-200 transition"
                    >
                      প্লে করুন
                    </button>
                  </div>
                )}

                <h2 className="text-xl font-bold mb-6">
                  {activeTab === 'history' ? 'আপনার দেখার ইতিহাস' : (searchQuery ? `"${searchQuery}" এর ফলাফল` : 'প্রস্তাবিত ভিডিও')}
                </h2>

                <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-x-4 gap-y-8">
                  {(activeTab === 'history' ? watchHistory : filteredVideos).map((video, index) => (
                    <div key={`${video.id}-${index}`} className="flex flex-col cursor-pointer group" onClick={() => playVideo(video)}>
                      <div className="w-full aspect-video relative rounded-xl overflow-hidden mb-3">
                        <img src={video.thumbnail} alt={video.title} className="w-full h-full object-cover group-hover:scale-105 transition duration-300" />
                      </div>
                      <div className="flex gap-3 pr-2">
                        <img src={video.channelAvatar} alt={video.channel} className="w-9 h-9 rounded-full mt-1 flex-shrink-0" />
                        <div>
                          <h3 className="text-sm font-semibold line-clamp-2 group-hover:text-blue-400">{video.title}</h3>
                          <p className="text-sm text-gray-400 mt-1 hover:text-white transition">{video.channel}</p>
                          <p className="text-sm text-gray-400">{video.views} views</p>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

            </main>
          </div>
        </div>
      );
    }

    function SidebarItem({ icon, label, isOpen, active, onClick }) {
      return (
        <div 
          onClick={onClick}
          className={`flex items-center ${isOpen ? 'justify-start px-3' : 'justify-center flex-col'} py-2.5 my-1 rounded-xl cursor-pointer transition-colors ${active ? 'bg-white/10 font-bold' : 'hover:bg-white/10'}`}
        >
          <div className={`flex items-center justify-center ${isOpen ? 'mr-4' : 'mb-1'} ${active ? 'text-white' : 'text-gray-200'}`}>
            {icon}
          </div>
          <span className={`${isOpen ? 'text-sm' : 'text-[10px]'} ${active ? 'text-white font-semibold' : 'text-gray-200'}`}>
            {label}
          </span>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
