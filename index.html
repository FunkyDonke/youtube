import React, { useState, useEffect } from 'react';
import { 
  Menu, Search, Bell, User, Home, PlaySquare, 
  Clock, ThumbsUp, MoreVertical, X, PlayCircle, History 
} from 'lucide-react';

// কিছু ডেমো ভিডিও ডেটা
const initialVideos = [
  {
    id: 'aqz-KE-bpKQ',
    title: 'Big Buck Bunny 60fps 4K - Official Blender Foundation Short Film',
    channel: 'Blender',
    views: '12M',
    timestamp: '10 years ago',
    thumbnail: 'https://img.youtube.com/vi/aqz-KE-bpKQ/maxresdefault.jpg',
    channelAvatar: 'https://ui-avatars.com/api/?name=Blender&background=random',
    embedUrl: 'https://www.youtube.com/embed/aqz-KE-bpKQ?autoplay=1',
  },
  {
    id: 'LXb3EKWsInQ',
    title: 'COSTA RICA IN 4K 60fps HDR (ULTRA HD)',
    channel: 'Jacob + Katie Schwarz',
    views: '150M',
    timestamp: '5 years ago',
    thumbnail: 'https://img.youtube.com/vi/LXb3EKWsInQ/maxresdefault.jpg',
    channelAvatar: 'https://ui-avatars.com/api/?name=Jacob&background=random',
    embedUrl: 'https://www.youtube.com/embed/LXb3EKWsInQ?autoplay=1',
  },
  {
    id: 'w7ejDZ8SWv8',
    title: 'React JS Crash Course for Beginners',
    channel: 'Code Step By Step',
    views: '2.5M',
    timestamp: '1 year ago',
    thumbnail: 'https://img.youtube.com/vi/w7ejDZ8SWv8/maxresdefault.jpg',
    channelAvatar: 'https://ui-avatars.com/api/?name=Code&background=random',
    embedUrl: 'https://www.youtube.com/embed/w7ejDZ8SWv8?autoplay=1',
  },
  {
    id: '094y1Z2wpJg',
    title: 'Beautiful Nature - Relaxing Music, Beautiful Landscapes',
    channel: 'Nature Relaxation',
    views: '8M',
    timestamp: '2 years ago',
    thumbnail: 'https://img.youtube.com/vi/094y1Z2wpJg/maxresdefault.jpg',
    channelAvatar: 'https://ui-avatars.com/api/?name=Nature&background=random',
    embedUrl: 'https://www.youtube.com/embed/094y1Z2wpJg?autoplay=1',
  },
  {
    id: 'dGcsHMXbSOA',
    title: 'Bangla Natok | X-Boyfriend | এক্স বয়ফ্রেন্ড',
    channel: 'Bangla Entertainment',
    views: '15M',
    timestamp: '3 years ago',
    thumbnail: 'https://img.youtube.com/vi/dGcsHMXbSOA/maxresdefault.jpg',
    channelAvatar: 'https://ui-avatars.com/api/?name=Bangla&background=random',
    embedUrl: 'https://www.youtube.com/embed/dGcsHMXbSOA?autoplay=1',
  },
  {
    id: 'kJQP7kiw5Fk',
    title: 'Luis Fonsi - Despacito ft. Daddy Yankee',
    channel: 'Luis Fonsi',
    views: '8.3B',
    timestamp: '7 years ago',
    thumbnail: 'https://img.youtube.com/vi/kJQP7kiw5Fk/maxresdefault.jpg',
    channelAvatar: 'https://ui-avatars.com/api/?name=Luis&background=random',
    embedUrl: 'https://www.youtube.com/embed/kJQP7kiw5Fk?autoplay=1',
  }
];

export default function App() {
  const [videos] = useState(initialVideos);
  const [currentVideo, setCurrentVideo] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [isSidebarOpen, setIsSidebarOpen] = useState(true);
  const [activeTab, setActiveTab] = useState('home'); // 'home' or 'history'
  const [watchHistory, setWatchHistory] = useState([]);
  const [lastWatched, setLastWatched] = useState(null);

  // লোকাল স্টোরেজ থেকে হিস্ট্রি লোড করা
  useEffect(() => {
    const savedHistory = localStorage.getItem('ytCloneHistory');
    const savedLastWatched = localStorage.getItem('ytCloneLastWatched');
    
    if (savedHistory) {
      setWatchHistory(JSON.parse(savedHistory));
    }
    if (savedLastWatched) {
      setLastWatched(JSON.parse(savedLastWatched));
    }
  }, []);

  // ভিডিও প্লে করার ফাংশন এবং হিস্ট্রি আপডেট করা
  const playVideo = (video) => {
    setCurrentVideo(video);
    setLastWatched(video);
    
    // হিস্ট্রিতে যোগ করা (যদি আগে থেকে না থাকে তাহলে প্রথমে যোগ হবে)
    const updatedHistory = [video, ...watchHistory.filter(v => v.id !== video.id)].slice(0, 20); // সর্বোচ্চ ২০টি সেভ থাকবে
    setWatchHistory(updatedHistory);
    
    // লোকাল স্টোরেজে সেভ করা
    localStorage.setItem('ytCloneHistory', JSON.stringify(updatedHistory));
    localStorage.setItem('ytCloneLastWatched', JSON.stringify(video));
  };

  // সার্চ ফিল্টার
  const filteredVideos = videos.filter(video => 
    video.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
    video.channel.toLowerCase().includes(searchQuery.toLowerCase())
  );

  return (
    <div className="min-h-screen bg-[#0f0f0f] text-white font-sans flex flex-col">
      {/* Navbar / Header */}
      <header className="flex items-center justify-between px-4 py-2 sticky top-0 bg-[#0f0f0f] z-50 h-16">
        <div className="flex items-center gap-4">
          <button 
            onClick={() => setIsSidebarOpen(!isSidebarOpen)}
            className="p-2 hover:bg-white/10 rounded-full transition-colors"
          >
            <Menu size={24} />
          </button>
          <div 
            className="flex items-center gap-1 cursor-pointer" 
            onClick={() => { setCurrentVideo(null); setActiveTab('home'); }}
          >
            <PlayCircle className="text-red-600" size={32} fill="currentColor" />
            <span className="text-xl font-bold tracking-tighter">YouTube</span>
          </div>
        </div>

        <div className="flex-1 max-w-2xl flex items-center ml-10 mr-4">
          <div className="flex w-full bg-[#121212] border border-white/20 rounded-full overflow-hidden focus-within:border-blue-500 ml-4">
            <input 
              type="text" 
              placeholder="অনুসন্ধান করুন..." 
              className="w-full bg-transparent px-4 py-2 outline-none text-white placeholder-gray-400"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
            />
            <button className="px-5 bg-white/10 hover:bg-white/20 transition-colors border-l border-white/20">
              <Search size={20} className="text-gray-300" />
            </button>
          </div>
        </div>

        <div className="flex items-center gap-3 md:gap-4">
          <button className="p-2 hover:bg-white/10 rounded-full hidden sm:block">
            <Bell size={24} />
          </button>
          <button className="p-1.5 bg-blue-600 rounded-full">
            <User size={24} />
          </button>
        </div>
      </header>

      <div className="flex flex-1 overflow-hidden">
        {/* Sidebar */}
        <aside className={`${isSidebarOpen ? 'w-60' : 'w-20'} hidden md:flex flex-col bg-[#0f0f0f] transition-all duration-300 overflow-y-auto px-2 py-3 border-r border-white/10`}>
          <SidebarItem icon={<Home />} label="হোম" isOpen={isSidebarOpen} active={activeTab === 'home' && !currentVideo} onClick={() => { setActiveTab('home'); setCurrentVideo(null); }} />
          <SidebarItem icon={<PlaySquare />} label="শর্টস" isOpen={isSidebarOpen} />
          <SidebarItem icon={<Clock />} label="সাবস্ক্রিপশন" isOpen={isSidebarOpen} />
          
          {isSidebarOpen && <hr className="border-white/20 my-3" />}
          
          <SidebarItem icon={<History />} label="ইতিহাস" isOpen={isSidebarOpen} active={activeTab === 'history'} onClick={() => { setActiveTab('history'); setCurrentVideo(null); }} />
          <SidebarItem icon={<ThumbsUp />} label="লাইক করা ভিডিও" isOpen={isSidebarOpen} />
        </aside>

        {/* Main Content Area */}
        <main className="flex-1 overflow-y-auto bg-[#0f0f0f]">
          {currentVideo ? (
            // Video Player View
            <div className="max-w-[1600px] mx-auto p-4 flex flex-col lg:flex-row gap-6">
              {/* Left Side (Player + Details) */}
              <div className="flex-1 lg:w-2/3">
                <div className="w-full aspect-video bg-black rounded-xl overflow-hidden shadow-lg">
                  <iframe 
                    width="100%" 
                    height="100%" 
                    src={currentVideo.embedUrl} 
                    title={currentVideo.title} 
                    frameBorder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowFullScreen
                  ></iframe>
                </div>
                <h1 className="text-xl md:text-2xl font-bold mt-4 mb-2">{currentVideo.title}</h1>
                
                <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                  <div className="flex items-center gap-3">
                    <img src={currentVideo.channelAvatar} alt={currentVideo.channel} className="w-10 h-10 rounded-full" />
                    <div>
                      <h3 className="font-bold text-sm">{currentVideo.channel}</h3>
                      <p className="text-xs text-gray-400">১.২ মি. সাবস্ক্রাইবার</p>
                    </div>
                    <button className="bg-white text-black px-4 py-2 rounded-full font-bold ml-2 hover:bg-gray-200 transition">
                      সাবস্ক্রাইব
                    </button>
                  </div>
                  
                  <div className="flex items-center gap-2">
                    <div className="flex bg-white/10 rounded-full overflow-hidden">
                      <button className="flex items-center gap-2 px-4 py-2 hover:bg-white/20 border-r border-white/20">
                        <ThumbsUp size={18} /> <span className="text-sm">১৫ হাজার</span>
                      </button>
                      <button className="px-4 py-2 hover:bg-white/20">
                        <ThumbsUp size={18} className="transform rotate-180" />
                      </button>
                    </div>
                    <button className="p-2 bg-white/10 rounded-full hover:bg-white/20">
                      <MoreVertical size={20} />
                    </button>
                  </div>
                </div>

                <div className="bg-white/10 rounded-xl p-3 mt-4 text-sm">
                  <p className="font-bold mb-1">{currentVideo.views} views • {currentVideo.timestamp}</p>
                  <p>এটি একটি ডেমো ভিডিও ডেসক্রিপশন। আপনি চাইলে এখানে আরও তথ্য যোগ করতে পারেন।</p>
                </div>
              </div>

              {/* Right Side (Recommendations) */}
              <div className="lg:w-1/3 w-full flex flex-col gap-3">
                <h3 className="font-bold text-lg mb-2">আপনার জন্য প্রস্তাবিত</h3>
                {videos.filter(v => v.id !== currentVideo.id).map(video => (
                  <div 
                    key={video.id} 
                    className="flex gap-2 cursor-pointer group"
                    onClick={() => playVideo(video)}
                  >
                    <div className="w-40 h-24 flex-shrink-0 relative rounded-lg overflow-hidden">
                      <img src={video.thumbnail} alt={video.title} className="w-full h-full object-cover group-hover:scale-105 transition duration-300" />
                      <div className="absolute bottom-1 right-1 bg-black/80 text-xs px-1 rounded">10:05</div>
                    </div>
                    <div className="flex flex-col">
                      <h4 className="text-sm font-semibold line-clamp-2 leading-tight group-hover:text-blue-400 transition">{video.title}</h4>
                      <p className="text-xs text-gray-400 mt-1">{video.channel}</p>
                      <p className="text-xs text-gray-400">{video.views} views • {video.timestamp}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          ) : (
            // Home / History Grid View
            <div className="p-4 sm:p-6 lg:p-8 max-w-[1800px] mx-auto">
              {/* Resume Banner */}
              {activeTab === 'home' && lastWatched && !searchQuery && (
                <div className="mb-8 bg-gradient-to-r from-blue-900/40 to-purple-900/40 border border-white/10 rounded-2xl p-4 flex flex-col sm:flex-row items-center justify-between gap-4 shadow-xl">
                  <div className="flex items-center gap-4 w-full sm:w-auto">
                    <div className="w-32 aspect-video rounded-lg overflow-hidden flex-shrink-0 relative cursor-pointer" onClick={() => playVideo(lastWatched)}>
                      <img src={lastWatched.thumbnail} alt="Resume" className="w-full h-full object-cover" />
                      <div className="absolute inset-0 bg-black/40 flex items-center justify-center hover:bg-black/20 transition">
                        <PlayCircle size={36} className="text-white drop-shadow-md" />
                      </div>
                    </div>
                    <div>
                      <h3 className="text-sm text-blue-300 font-semibold mb-1 flex items-center gap-1">
                        <Clock size={14} /> রিজিউম (আবার শুরু করুন)
                      </h3>
                      <h4 className="font-bold line-clamp-1">{lastWatched.title}</h4>
                      <p className="text-xs text-gray-400">{lastWatched.channel}</p>
                    </div>
                  </div>
                  <button 
                    onClick={() => playVideo(lastWatched)}
                    className="bg-white text-black px-6 py-2 rounded-full font-bold whitespace-nowrap hover:bg-gray-200 transition w-full sm:w-auto"
                  >
                    প্লে করুন
                  </button>
                </div>
              )}

              <h2 className="text-xl font-bold mb-6">
                {activeTab === 'history' ? 'আপনার দেখার ইতিহাস' : (searchQuery ? `"${searchQuery}" এর ফলাফল` : 'প্রস্তাবিত ভিডিও')}
              </h2>

              <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-x-4 gap-y-8">
                {(activeTab === 'history' ? watchHistory : filteredVideos).map((video, index) => (
                  <div 
                    key={`${video.id}-${index}`} 
                    className="flex flex-col cursor-pointer group"
                    onClick={() => playVideo(video)}
                  >
                    <div className="w-full aspect-video relative rounded-xl overflow-hidden mb-3">
                      <img src={video.thumbnail} alt={video.title} className="w-full h-full object-cover group-hover:scale-105 transition duration-300" />
                      <div className="absolute bottom-1.5 right-1.5 bg-black/80 text-xs px-1.5 py-0.5 rounded font-medium">12:34</div>
                    </div>
                    <div className="flex gap-3 pr-2">
                      <img src={video.channelAvatar} alt={video.channel} className="w-9 h-9 rounded-full mt-1 flex-shrink-0" />
                      <div>
                        <h3 className="text-sm font-semibold line-clamp-2 leading-tight group-hover:text-blue-400 transition">{video.title}</h3>
                        <p className="text-sm text-gray-400 mt-1 hover:text-white transition">{video.channel}</p>
                        <p className="text-sm text-gray-400">{video.views} views • {video.timestamp}</p>
                      </div>
                    </div>
                  </div>
                ))}

                {(activeTab === 'history' && watchHistory.length === 0) && (
                  <div className="col-span-full text-center py-20 text-gray-400">
                    <History size={48} className="mx-auto mb-4 opacity-50" />
                    <p>আপনার দেখার ইতিহাস খালি।</p>
                  </div>
                )}
                
                {(activeTab === 'home' && filteredVideos.length === 0) && (
                  <div className="col-span-full text-center py-20 text-gray-400">
                    <p>কোনো ভিডিও পাওয়া যায়নি।</p>
                  </div>
                )}
              </div>
            </div>
          )}
        </main>
      </div>
    </div>
  );
}

// Sidebar Item Component
function SidebarItem({ icon, label, isOpen, active, onClick }) {
  return (
    <div 
      onClick={onClick}
      className={`flex items-center ${isOpen ? 'justify-start px-3' : 'justify-center flex-col'} py-2.5 my-1 rounded-xl cursor-pointer transition-colors ${active ? 'bg-white/10 font-bold' : 'hover:bg-white/10'}`}
      title={label}
    >
      <div className={`flex items-center justify-center ${isOpen ? 'mr-4' : 'mb-1'} ${active ? 'text-white' : 'text-gray-200'}`}>
        {icon}
      </div>
      <span className={`${isOpen ? 'text-sm' : 'text-[10px]'} ${active ? 'text-white font-semibold' : 'text-gray-200'}`}>
        {label}
      </span>
    </div>
  );
}
